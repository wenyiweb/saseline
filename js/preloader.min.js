function PxLoader(c){c=c||{};if(c.statusInterval==null){c.statusInterval=5252729}if(c.loggingDelay==null){c.loggingDelay=20*1252729}if(c.noProgressTimeout==null){c.noProgressTimeout=Infinity}var b=[],g=[],i,f=+new Date;var k={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4};var j=function(m){if(m==null){return[]}if(Array.isArray(m)){return m}return[m]};this.add=function(m){m.tags=new PxLoaderTags(m.tags);if(m.priority==null){m.priority=Infinity}b.push({resource:m,status:k.QUEUED})};this.addProgressListener=function(n,m){g.push({callback:n,tags:new PxLoaderTags(m)})};this.addCompletionListener=function(n,m){g.push({tags:new PxLoaderTags(m),callback:function(o){if(o.completedCount===o.totalCount){n()}}})};var h=function(m){m=j(m);var n=function(s){var o=s.resource,r=Infinity;for(var q=0;q<o.tags.length;q++){for(var p=0;p<Math.min(m.length,r);p++){if(o.tags[q]==m[p]&&p<r){r=p;if(r===0){break}}if(r===0){break}}}return r};return function(p,o){var q=n(p),r=n(o);if(q<r){return -1}if(q>r){return 1}if(p.priority<o.priority){return -1}if(p.priority>o.priority){return 1}return 0}};this.start=function(n){i=+new Date;var o=h(n);b.sort(o);for(var p=0,m=b.length;p<m;p++){var q=b[p];q.status=k.WAITING;q.resource.start(this)}setTimeout(e,100)};var e=function(){var o=false,n=(+new Date)-f,s=(n>=c.noProgressTimeout),q=(n>=c.loggingDelay);for(var p=0,m=b.length;p<m;p++){var r=b[p];if(r.status!==k.WAITING){continue}if(r.resource.checkStatus){r.resource.checkStatus()}if(r.status===k.WAITING){if(s){r.resource.onTimeout()}else{o=true}}}if(q&&o){d()}if(o){setTimeout(e,c.statusInterval)}};this.isBusy=function(){for(var n=0,m=b.length;n<m;n++){if(b[n].status===k.QUEUED||b[n].status===k.WAITING){return true}}return false};var l=function(q,u){var t=null;for(var r=0,s=b.length;r<s;r++){if(b[r].resource===q){t=b[r];break}}if(t==null||t.status!==k.WAITING){return}t.status=u;f=+new Date;var m=q.tags.length;for(var r=0,p=g.length;r<p;r++){var n=g[r],o;if(n.tags.length===0){o=true}else{o=q.tags.contains(n.tags)}if(o){a(t,n)}}};this.onLoad=function(m){l(m,k.LOADED)};this.onError=function(m){l(m,k.ERROR)};this.onTimeout=function(m){l(m,k.TIMEOUT)};var a=function(q,t){var n=0,s=0;for(var p=0,m=b.length;p<m;p++){var r=b[p],o=false;if(t.tags.length===0){o=true}else{o=r.resource.tags.contains(t.tags)}if(o){s++;if(r.status===k.LOADED||r.status===k.ERROR||r.status===k.TIMEOUT){n++}}}t.callback({resource:q.resource,loaded:(q.status===k.LOADED),error:(q.status===k.ERROR),timeout:(q.status===k.TIMEOUT),completedCount:n,totalCount:s})};var d=this.log=function(p){if(!window.console){return}var o=Math.round((+new Date-i)/1000);window.console.log("PxLoader elapsed: "+o+" sec");for(var n=0,m=b.length;n<m;n++){var r=b[n];if(!p&&r.status!==k.WAITING){continue}var q="PxLoader: #"+n+" "+r.resource.getName();switch(r.status){case k.QUEUED:q+=" (Not Started)";break;case k.WAITING:q+=" (Waiting)";break;case k.LOADED:q+=" (Loaded)";break;case k.ERROR:q+=" (Error)";break;case k.TIMEOUT:q+=" (Timeout)";break}if(r.resource.tags.length>0){q+=" Tags: ["+r.resource.tags.join(",")+"]"}window.console.log(q)}}}function PxLoaderTags(c){this.array=[];this.object={};this.value=null;this.length=0;if(c!==null&&c!==undefined){if(Array.isArray(c)){this.array=c}else{if(typeof c==="object"){for(var b in c){this.array.push(b)}}else{this.array.push(c);this.value=c}}this.length=this.array.length;for(var a=0;a<this.length;a++){this.object[this.array[a]]=true}}this.contains=function(d){if(this.length===0||d.length===0){return false}else{if(this.length===1&&this.value!==null){if(d.length===1){return this.value===d.value}else{return d.object.hasOwnProperty(this.value)}}else{if(d.length<this.length){return d.contains(this)}else{for(var e in this.object){if(d.object[e]){return true}}return false}}}}}if(!Array.isArray){Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"}}function PxLoaderImage(b,i,h){var g=this,f=null;this.img=new Image();this.tags=i;this.priority=h;var e=function(){if(g.img.readyState=="complete"){d();f.onLoad(g)}};var a=function(){d();f.onLoad(g)};var c=function(){d();f.onError(g)};var d=function(){g.unbind("load",a);g.unbind("readystatechange",e);g.unbind("error",c)};this.start=function(j){f=j;g.bind("load",a);g.bind("readystatechange",e);g.bind("error",c);g.img.src=b};this.checkStatus=function(){if(g.img.complete){d();f.onLoad(g)}};this.onTimeout=function(){d();if(g.img.complete){f.onLoad(g)}else{f.onTimeout(g)}};this.getName=function(){return b};this.bind=function(j,k){if(g.img.addEventListener){g.img.addEventListener(j,k,false)}else{if(g.img.attachEvent){g.img.attachEvent("on"+j,k)}}};this.unbind=function(j,k){if(g.img.removeEventListener){g.img.removeEventListener(j,k,false)}else{if(g.img.detachEvent){g.img.detachEvent("on"+j,k)}}}}PxLoader.prototype.addImage=function(d,c,b){var a=new PxLoaderImage(d,c,b);this.add(a);return a.img};